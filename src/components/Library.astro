---
// Sheet ID and GID for Google Sheet
const SHEET_ID = '1UicZAW7Rf_59kcLWm1nghHFWbqouP6xTJ4uC3h_TmNQ';
const GID = '616135598';
---

<div id="library-container">
	<div id="loading-spinner" class="loading">
		<div class="spinner"></div>
		<p>Loading books...</p>
	</div>
	<ul id="books-list" style="display: none;"></ul>
</div>

<script is:inline>
	const SHEET_ID = '1UicZAW7Rf_59kcLWm1nghHFWbqouP6xTJ4uC3h_TmNQ';
	const GID = '616135598';
	const csvUrl = `https://docs.google.com/spreadsheets/d/${SHEET_ID}/export?format=csv&gid=${GID}`;
	
	const spinner = document.getElementById('loading-spinner');
	const booksList = document.getElementById('books-list');
	
	// Simple CSV parser that handles quoted fields
	function parseCSVLine(line) {
		const result = [];
		let current = '';
		let inQuotes = false;
		
		for (let i = 0; i < line.length; i++) {
			const char = line[i];
			if (char === '"') {
				inQuotes = !inQuotes;
			} else if (char === ',' && !inQuotes) {
				result.push(current.trim());
				current = '';
			} else {
				current += char;
			}
		}
		result.push(current.trim());
		return result;
	}
	
	async function loadBooks() {
		try {
			const response = await fetch(csvUrl);
			if (response.ok) {
				const csvText = await response.text();
				const lines = csvText.split('\n').filter(line => line.trim());
				
				// Skip header row and get column B (index 1)
				const books = lines
					.slice(1) // Skip header
					.map(line => {
						const columns = parseCSVLine(line);
						return columns[1]; // Column B (index 1)
					})
					.filter(book => book && book.trim() !== '' && book !== 'Books Already in Our Baby Library')
					.sort((a, b) => a.localeCompare(b, undefined, { sensitivity: 'base' }));
				
				// Hide spinner and show books
				if (spinner) spinner.style.display = 'none';
				if (booksList) {
					booksList.innerHTML = books.map(book => `<li>${book}</li>`).join('');
					booksList.style.display = 'block';
				}
			} else {
				throw new Error('Failed to fetch books');
			}
		} catch (error) {
			console.error('Error fetching books from Google Sheet:', error);
			if (spinner) {
				spinner.innerHTML = '<p>Error loading books. Please try again later.</p>';
			}
		}
	}
	
	loadBooks();
</script>

<style>
	.loading {
		display: flex;
		flex-direction: column;
		align-items: center;
		justify-content: center;
		padding: 2em;
	}
	
	.spinner {
		width: 40px;
		height: 40px;
		border: 4px solid rgba(var(--gray-light), 0.3);
		border-top: 4px solid var(--accent);
		border-radius: 50%;
		animation: spin 1s linear infinite;
		margin-bottom: 1em;
	}
	
	@keyframes spin {
		0% { transform: rotate(0deg); }
		100% { transform: rotate(360deg); }
	}
	
	#books-list {
		list-style: none;
		padding: 0;
	}
	
	#books-list li {
		padding: 0.5em 0;
		border-bottom: 1px solid rgba(var(--gray-light), 0.5);
	}
	
	#books-list li:last-child {
		border-bottom: none;
	}
</style>

